<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>L8Smartlight</title>
    
    <meta name="description" content="A nodejs library in order to facillitate communication with an L8 Smartlight" />
    
    
    
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content=""/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":true,"cleverLinks":true,"default":{"outputSourceFiles":true},"applicationName":"node-l8smartlight","disqus":"","googleAnalytics":"","openGraph":{"title":"","type":"website","image":"","site_name":"","url":""},"meta":{"title":"L8Smartlight","description":"A nodejs library in order to facillitate communication with an L8 Smartlight","keyword":""}};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">node-l8smartlight</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="AccelerationStream">
            <span class="title">
                <a href="AccelerationStream.html">AccelerationStream</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="AccelerationStream#cooldown_"><a href="AccelerationStream.html#cooldown_">cooldown_</a></li>
            
                <li data-name="AccelerationStream#l8_"><a href="AccelerationStream.html#l8_">l8_</a></li>
            
                <li data-name="AccelerationStream#requested_"><a href="AccelerationStream.html#requested_">requested_</a></li>
            
                <li data-name="AccelerationStream#samplingRate_"><a href="AccelerationStream.html#samplingRate_">samplingRate_</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="AccelerationStream#_read"><a href="AccelerationStream.html#_read">_read</a></li>
            
                <li data-name="AccelerationStream#onResponse_"><a href="AccelerationStream.html#onResponse_">onResponse_</a></li>
            
                <li data-name="AccelerationStream#poll_"><a href="AccelerationStream.html#poll_">poll_</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="L8">
            <span class="title">
                <a href="L8.html">L8</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="L8#isConnected"><a href="L8.html#isConnected">isConnected</a></li>
            
                <li data-name="L8#receiveBuffer_"><a href="L8.html#receiveBuffer_">receiveBuffer_</a></li>
            
                <li data-name="L8#serialport_"><a href="L8.html#serialport_">serialport_</a></li>
            
                <li data-name="L8.MAGIC_BYTES"><a href="L8.html#MAGIC_BYTES">MAGIC_BYTES</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="L8#buildFrame"><a href="L8.html#buildFrame">buildFrame</a></li>
            
                <li data-name="L8#clearLED"><a href="L8.html#clearLED">clearLED</a></li>
            
                <li data-name="L8#clearMatrix"><a href="L8.html#clearMatrix">clearMatrix</a></li>
            
                <li data-name="L8#clearScrollingText"><a href="L8.html#clearScrollingText">clearScrollingText</a></li>
            
                <li data-name="L8#clearSuperLED"><a href="L8.html#clearSuperLED">clearSuperLED</a></li>
            
                <li data-name="L8#close"><a href="L8.html#close">close</a></li>
            
                <li data-name="L8#createAccelerationStream"><a href="L8.html#createAccelerationStream">createAccelerationStream</a></li>
            
                <li data-name="L8#encodeBGRMatrixColor"><a href="L8.html#encodeBGRMatrixColor">encodeBGRMatrixColor</a></li>
            
                <li data-name="L8#encodeBGRSingleColor"><a href="L8.html#encodeBGRSingleColor">encodeBGRSingleColor</a></li>
            
                <li data-name="L8#encodeRGBSingleColor"><a href="L8.html#encodeRGBSingleColor">encodeRGBSingleColor</a></li>
            
                <li data-name="L8#getAcceleration"><a href="L8.html#getAcceleration">getAcceleration</a></li>
            
                <li data-name="L8#onResponse_"><a href="L8.html#onResponse_">onResponse_</a></li>
            
                <li data-name="L8#open"><a href="L8.html#open">open</a></li>
            
                <li data-name="L8#parseFrames_"><a href="L8.html#parseFrames_">parseFrames_</a></li>
            
                <li data-name="L8#ping"><a href="L8.html#ping">ping</a></li>
            
                <li data-name="L8#sendFrame"><a href="L8.html#sendFrame">sendFrame</a></li>
            
                <li data-name="L8#setLED"><a href="L8.html#setLED">setLED</a></li>
            
                <li data-name="L8#setMatrix"><a href="L8.html#setMatrix">setMatrix</a></li>
            
                <li data-name="L8#setOrientation"><a href="L8.html#setOrientation">setOrientation</a></li>
            
                <li data-name="L8#setScrollingText"><a href="L8.html#setScrollingText">setScrollingText</a></li>
            
                <li data-name="L8#setSuperLED"><a href="L8.html#setSuperLED">setSuperLED</a></li>
            
                <li data-name="L8#stopApplication"><a href="L8.html#stopApplication">stopApplication</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            <span class="subtitle">Events</span>
            
                <li data-name="L8#event:frameReceived"><a href="L8.html#event:frameReceived">frameReceived</a></li>
            
                <li data-name="L8#event:frameSent"><a href="L8.html#event:frameSent">frameSent</a></li>
            
            </ul>
        </li>
    
        <li class="item" data-name="MatrixBuilder">
            <span class="title">
                <a href="MatrixBuilder.html">MatrixBuilder</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="MatrixBuilder#initialMatrix_"><a href="MatrixBuilder.html#initialMatrix_">initialMatrix_</a></li>
            
                <li data-name="MatrixBuilder#operations_"><a href="MatrixBuilder.html#operations_">operations_</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="MatrixBuilder.map"><a href="MatrixBuilder.html#map">map</a></li>
            
                <li data-name="MatrixBuilder#column"><a href="MatrixBuilder.html#column">column</a></li>
            
                <li data-name="MatrixBuilder#createArrayWithSize"><a href="MatrixBuilder.html#createArrayWithSize">createArrayWithSize</a></li>
            
                <li data-name="MatrixBuilder#operation"><a href="MatrixBuilder.html#operation">operation</a></li>
            
                <li data-name="MatrixBuilder#rectangle"><a href="MatrixBuilder.html#rectangle">rectangle</a></li>
            
                <li data-name="MatrixBuilder#row"><a href="MatrixBuilder.html#row">row</a></li>
            
                <li data-name="MatrixBuilder#toMatrix"><a href="MatrixBuilder.html#toMatrix">toMatrix</a></li>
            
                <li data-name="MatrixBuilder#validateColors_"><a href="MatrixBuilder.html#validateColors_">validateColors_</a></li>
            
                <li data-name="MatrixBuilder#validateCoordinates_"><a href="MatrixBuilder.html#validateCoordinates_">validateCoordinates_</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="AccelerationStream.js.html">Source: AccelerationStream.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source"><code>var util = require('util');
var Stream = require('stream');

/**
 * Time based stream of acceleration data from the L8.
 *
 * The stream is an object mode stream. It therefore does not return a buffer
 * if read, but one Acceleration data struct at a time. The data structure is
 * identical with the one you would get from the {@link L8#getAcceleration} method.
 *
 * The L8 only provides the Acceleration information if they are polled. This
 * stream takes care of polling the data at a given sampling rate and providing
 * it to you in an easily accessible way.
 *
 * The stream automatically takes care of starting and stopping the data polling
 * once a *listener* is connected or disconnected. Therefore you do not need to
 * take care of this nasty business yourself.
 *
 * The Stream needs an instance of the L8 class to attach to, as well as an optional
 * `samplingRate_`. The sampling rate tells the system which timeframe (in msec) should be
 * waited between two data polls. If none is given `100 msec` is assumed by default.
 *
 * In order to utilize the Stream simply wrap it around an L8 instance and attach to the
 * corresponding [Stream](http://nodejs.org/api/stream.html#stream_class_stream_readable)
 * event handlers:
 *
 * @example ```
 *  var l8 = //...
 *
 *  var acceleration = new AccelerationStream(l8, 200);
 *  acceleration.on("data", function(data) {
 *      // Do something with each part of the acceleration data here.
 *  });
 * ```
 *
 * Alternatively the convenience function {@link L8#createAccelerationStream} can
 * be used to get an already connected stream directly from an L8 instance
 *
 * @example ```
 *  var l8 = //...
 *  var acceleration = l8.createAccelerationStream(200);
 *  acceleration.on("data", function(data) {
 *      // Do something with each part of the acceleration data here.
 *  });
 * ```
 *
 * @param {L8} l8 Instance of the L8 to attach to.
 * @param {int} [samplingRate]
 * @constructor
 */
var AccelerationStream = function(l8, samplingRate) {
    samplingRate = samplingRate || 100;

    /**
     * Instance of the L8 to access for acceleration data
     * @type {L8}
     *
     * @private
     */
    this.l8_ = l8;

    /**
     * Sampling rate which defines in which interval the data is polled from the L8
     *
     * @type {Number}
     * @private
     */
    this.samplingRate_ = samplingRate;

    /**
     * Status flag indicating whether the stream is in cooldown mode, aka. if it is
     * currently waiting for the next sampling interval to occur.
     *
     * @type {boolean}
     * @private
     */
    this.cooldown_ = false;

    /**
     * Status flag indicating whether a request to read a new acceleration data package
     * was issued during the current cooldown mode
     *
     * @type {boolean}
     * @private
     */
    this.requested_ = false;

    /*
     * The underlying stream should operate in Object mode.
     * Furthermore the internal Stream buffer needs to be disabled, as we have
     * a time based stream here, which always should provide the newest data.
     */
    var options = {
        objectMode: true,
        highWaterMark: 0
    };
    // Call super constructor
    Stream.Readable.call(this, options);
};
util.inherits(AccelerationStream, Stream.Readable);

/**
 * Poll the acceleration information from the L8.
 *
 * After the polling is complete the {@link AccelerationStream#onResponse_} method
 * will be invoked as callback.
 *
 * @private
 */
AccelerationStream.prototype.poll_ = function() {
    this.l8_.getAcceleration(this.onResponse_.bind(this));
};

/**
 * Callback invoked each time acceleration data has been read from the L8
 *
 * The information is retrieved directly from the `getAcceleration` method.
 *
 * @param {String?} error
 * @param {Object} data
 * @private
 */
AccelerationStream.prototype.onResponse_ = function(error, data) {
    this.requested_ = false;
    this.cooldown_ = true;

    if(error) {
        throw new Error('An error occured while reading the acceleration information: ' + error);
    }

    setTimeout(function() {
        this.cooldown_ = false;
        if (this.requested_) {
            this.poll_();
        }
    }.bind(this), this.samplingRate_);

    // Push the read information into the Streams read buffer to distribution^^
    this.push(data);
};

/**
 * Triggered by the stream API in case the read buffer needs to be filled with information.
 *
 * @private
 */
AccelerationStream.prototype._read = function() {
    if (this.cooldown_) {
        this.requested_ = true;
        return;
    }

    this.poll_();
};

exports.AccelerationStream = AccelerationStream;</code></pre>
        </article>
    </section>





        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Sat Jul 05 2014 13:21:56 GMT+0200 (MESZ)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>
